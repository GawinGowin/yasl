# CLAUDE.md

このファイルは、Claude Code (claude.ai/code) がこのリポジトリで作業する際のガイダンスを提供します。

## プロジェクト概要

**YASL (Yet Another Stack Language)** プロジェクトです。YASLは多重逆順スタックパラダイムに基づいたインタプリタ言語で、元々は非IT専門家のユーザー向けに高レベルの会計および財務処理のために設計されました。この言語は非公開に作成された独自の言語であり、Google 検索でドキュメントやリソースを見つけることは困難です。

この言語仕様の習得が主な目的です。`./docs`にユーザーからの要求に対してドキュメントを適宜生成する必要があります。
ドキュメント作成時における、yaslコードのコメントアウトは`//`を使用してください。

## 開発環境

このプロジェクトはDockerベースの開発コンテナ（devcontainer）を使用しています：

- ベースイメージ: `mcr.microsoft.com/devcontainers/cpp:1.2.7-debian12`
- YASLインタプリタ: `/usr/local/bin/yasl` (42.fr CDNからダウンロード)
- Claude Codeがnpm経由でグローバルインストール済み

### 環境の起動

プロジェクトはdevcontainerで実行するように構成されています。ワークスペースはコンテナ内の `/workspace` にマウントされます。

## YASL言語の基礎

### 実行モデル

- YASLは**多重逆順スタック**を使用（デフォルト：10個のスタック）
- スタックは**上方向に成長**し、操作はスタックの**底**で行われる
- プログラムは最初から最後まで順次実行される
- 4つのデータ型：**整数**、**文字列**、**浮動小数点数**、**リスト**

### スタックセレクタ構文

操作は入力・出力スタックを指定するためにスタックセレクタを使用します：
```
<入力スタック>:<操作>:<出力スタック>
```

動的スタック選択の代替構文：
```
$<スタックから入力>:<操作>:$<スタックから出力>
```

スタックセレクタが省略された場合、現在の入力・出力スタックが使用されます（プログラム開始時は両方とも0）。

### 操作修飾子

- `#` - 後続の操作をN回繰り返す（スタックから回数をポップ）
- `%` - パラメータをポップする代わりにスタックに保持する

### 主要演算子

**基本演算:**
- `+ - * / %` - 5つの基本演算子（2つの引数を使用）

**スタック操作:**
- `!` - ドロップ（最初の引数を削除）
- `=` - 複製（最初の引数を複製）
- `#` - カウント（スタック内の要素数を出力スタックに追加）

**比較演算子:**
- `< > <= >= == !=` - 2つの引数を使用

**ロール操作:**
- `^` - ロール（整数Nをポップし、後続N個の引数を1ポジションロール）
- `!^` - アンロール（逆方向のロール）

**論理演算子:**
- `&&` - AND（2つの引数）
- `||` - OR（2つの引数）
- `~~` - NOT（1つの引数）

**ビット演算子:**
- `&` - AND（2つの引数）
- `|` - OR（2つの引数）
- `~` - NOT（1つの引数）

**シフト演算子:**
- `<<` - 左シフト
- `>>` - 右シフト

**リスト操作:**
- `[]` - リスト作成（最初の引数＝要素数）
- `][` - アンリスト（リストを展開し、要素数をプッシュ）
- `[#]` - リストカウント（リスト内の要素数）
- `]#[` - リスト要素取得（インデックスで要素を抽出）

### 制御構造

**テスト構造:**
```yasl
? <操作>              // スタックのトップが真なら実行
? <操作> : <操作>     // 真なら最初、偽なら2番目を実行
```

**ループ構造:**
```yasl
@ <操作>              // スタックのトップが偽になるまで繰り返す
```

### 標準ライブラリ関数

- `print` - 最初のスタック引数を出力
- `read` - 標準入力から1行読み取り（インタラクティブモードでは動作しない）
- `eval` - 文字列引数を解析して実行
- `exit` - プログラムを終了（最初の引数＝終了コード）

### スクリプト形式

YASLスクリプトは以下のシバンで始まります：
```yasl
#!/usr/local/bin/yasl
```

## YASLプログラムの実行

スクリプトの実行：
```bash
yasl <スクリプトファイル>
```

実行可能にして直接実行：
```bash
chmod +x <スクリプトファイル>
./<スクリプトファイル>
```

マニュアルの表示：
```bash
man yasl
```

## リポジトリ内のサンプルプログラム

### `yasl_hw` - Hello World
基本的な文字列出力を示す例。複数の文字列をスタックにプッシュし、スタック要素数分printを繰り返します。

**動作の流れ:**
```yasl
#!/usr/local/bin/yasl

#!              // コマンドライン引数をドロップ

"world\n"       // スタックに "world\n" をプッシュ
"Hello "        // スタックに "Hello " をプッシュ

#               // スタック要素数（2）を取得
#print          // print を 2回繰り返す
```

### `sum` - 複数スタック操作と演算
複数のスタックを使用した算術演算を示す例。スタック2を使用して `(100 + 200) * 300 + 1` を計算します。

**動作の流れ:**
```yasl
!!              // 引数を2つドロップ
1 2 0:+:0 3 0:*:0 print  // スタック0で (1+2)*3 = 9 を計算して出力

// スタック2を使った計算
100 0:=:2 !     // 100をスタック2にコピーしてスタック0をドロップ
200 0:=:2 !     // 200をスタック2にコピーしてスタック0をドロップ
2:+:2           // スタック2で加算（300）
300 0:=:2 !     // 300をスタック2にコピー
2:*:2           // スタック2で乗算（90000）
1 0:=:2 !       // 1をスタック2にコピー
2:+:2           // スタック2で加算（90001）
2: print        // スタック2から出力
```

### `loop` - ループ制御構造
ループとデクリメント処理を示す例。10回「hello world」を出力します。

**動作の流れ:**
```yasl
!!              // 引数をドロップ

10              // カウンタを10で初期化
%@ (            // % 修飾子でカウンタを保持したままループ
    "hello world\n"
    print
    (           // サブセット：デクリメント処理
        0:(1 -):0   // スタック0の値から1を引く
    )
)               // カウンタが0（偽）になるまで繰り返す
```

## 詳細ドキュメント

より詳細な情報は以下を参照してください：
- `docs/yasl.jp.man.md` - YASLの日本語マニュアル
- `man yasl` - システムにインストールされたマニュアルページ
